@page "/createuser"
@using Dormie.Models
@using Microsoft.AspNetCore.Components.Forms
@inject Dormie.Services.UserService UserService

<div class="container d-flex justify-content-center align-items-center min-vh-70">
    <EditForm Model="@user" OnValidSubmit="HandleSubmit" FormName="CreateUserForm"
              class="card p-4 rounded-4 shadow-sm" style="width: 80%;">
        <DataAnnotationsValidator />

        <div class="row">
            <div class="col-xl-6 col-12">
                <label class="form-label">First Name</label>
                <InputText class="form-control" @bind-Value="user.FirstName" />
                <ValidationMessage For="@(() => user.FirstName)" />
            </div>

            <div class="col-xl-6 col-12">
                <label class="form-label">Last Name</label>
                <InputText class="form-control" @bind-Value="user.LastName" />
                <ValidationMessage For="@(() => user.LastName)" />
            </div>

            <div class="col-xl-6 col-12">
                <label class="form-label">Contact No.</label>
                <InputText class="form-control" @bind-Value="user.ContactNumber" />
                <ValidationMessage For="@(() => user.ContactNumber)" />
            </div>

            <div class="col-xl-6 col-12">
                <label class="form-label">Email</label>
                <InputText class="form-control" @bind-Value="user.Email" />
                <ValidationMessage For="@(() => user.Email)" />
            </div>

            <div class="col-12 my-2">
                <label>User Type</label>
                <InputRadioGroup @bind-Value="user.UserType">
                    <InputRadio Value="@UserTypeEnum.Renter" /> Renter
                    <InputRadio Value="@UserTypeEnum.Owner" /> Owner
                </InputRadioGroup>
                <ValidationMessage For="@(() => user.UserType)" />
            </div>

            <div class="col-xl-6 col-12">
                <label class="form-label">Password</label>
                <InputText class="form-control" type="password" @bind-Value="user.Password" />
                <ValidationMessage For="@(() => user.Password)" />
            </div>

            <div class="col-xl-6 col-12">
                <label class="form-label">Confirm Password</label>
                <InputText class="form-control" type="password" @bind-Value="user.ConfirmPassword" />
                <ValidationMessage For="@(() => user.ConfirmPassword)" />
            </div>

            <div class="col-12 my-3">
                <InputCheckbox @bind-Value="user.AcceptedTerms" />
                <label> I agree to the Terms and Conditions</label>
                <ValidationMessage For="@(() => user.AcceptedTerms)" />
            </div>

            <div class="col-12">
                <button type="submit" class="btn btn-primary" disabled="@IsSubmitting">
                    @(IsSubmitting ? "Creating account..." : "Submit")
                </button>
            </div>
        </div>
    </EditForm>
</div>

@if (!string.IsNullOrEmpty(Message))
{
    <div class="alert alert-info mt-3">@Message</div>
}

@code {
    User user = new User();  // must initialize

    string Message;
    bool IsSubmitting = false;

    async Task HandleSubmit()
    {
        try
        {
            IsSubmitting = true;
            await UserService.CreateUserAsync(user);
            Message = "Account created successfully!";
            user = new User(); // reset
        }
        catch (Exception ex)
        {
            Message = ex.Message;
        }
        finally
        {
            IsSubmitting = false;
        }
    }
}
